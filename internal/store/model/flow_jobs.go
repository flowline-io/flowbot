package model

import "time"

// FlowJob records per-node execution details for a flow execution.
// It is used by IF-THEN flows for execution tracing.
//
// Note: This model is hand-written (not generated by gorm.io/gen).
type FlowJob struct {
	ID          int64      `gorm:"column:id;primaryKey;autoIncrement:true" json:"id"`
	FlowID      int64      `gorm:"column:flow_id;not null" json:"flow_id"`
	ExecutionID string     `gorm:"column:execution_id;not null" json:"execution_id"`
	NodeID      string     `gorm:"column:node_id;not null" json:"node_id"`
	NodeType    NodeType   `gorm:"column:node_type;not null" json:"node_type"`
	Bot         string     `gorm:"column:bot;not null" json:"bot"`
	RuleID      string     `gorm:"column:rule_id;not null" json:"rule_id"`
	Attempt     int        `gorm:"column:attempt;not null;default:1" json:"attempt"`
	State       JobState   `gorm:"column:state;not null" json:"state"`
	Params      JSON       `gorm:"column:params" json:"params"`
	Result      JSON       `gorm:"column:result" json:"result"`
	Error       string     `gorm:"column:error" json:"error"`
	StartedAt   *time.Time `gorm:"column:started_at" json:"started_at"`
	FinishedAt  *time.Time `gorm:"column:finished_at" json:"finished_at"`
	CreatedAt   time.Time  `gorm:"column:created_at;not null" json:"created_at"`
	UpdatedAt   time.Time  `gorm:"column:updated_at;not null" json:"updated_at"`
}

func (*FlowJob) TableName() string { return "flow_jobs" }
