# API Documentation

This directory contains all API-related documentation for the Flowbot project.

## File Descriptions

### `swagger.json` & `swagger.yaml`

- OpenAPI specification files
- Contains complete API interface definitions
- Auto-generated by `swaggo/swag`

### `docs.go`

- Auto-generated Go code with embedded Swagger definitions
- Provides Swagger UI at runtime

### `api.http`

- HTTP request examples collection
- Can be run directly in VS Code REST Client or IntelliJ HTTP Client

## Usage

### View API Documentation

After starting the server, visit: `http://localhost:6060/swagger/index.html`

### Generate/Update API Documentation

```bash
# Via task runner
task swagger

# Or directly
go tool swag init -g cmd/main.go -o ./docs/api
go tool swag fmt -g cmd/main.go
```

## API Overview

### Base URL

```
http://localhost:6060/service
```

### Authentication

API requests require an `X-AccessToken` header:

```
X-AccessToken: <your-token>
```

### Main API Modules

| Module | Description |
|--------|-------------|
| `dev` | Development and debugging |
| `search` | Full-text search (autocomplete, query) |
| `user` | User data (bookmarks, dashboard, kanban, metrics) |
| `server` | Server management (stacktrace, uploads) |
| `workflow` | Workflow management |

### Server Routes

| Route | Method | Description |
|-------|--------|-------------|
| `/livez` | GET | Liveness probe |
| `/readyz` | GET | Readiness probe |
| `/startupz` | GET | Startup probe |
| `/metrics` | GET | Prometheus metrics |
| `/oauth/:provider/:flag` | ALL | OAuth callbacks |
| `/webhook/:flag` | ALL | Webhook handler |
| `/chatbot/:platform` | ALL | Platform callbacks |
| `/mcp/:bot_name` | ALL | MCP protocol handler (bearer auth) |
| `/form` | POST | Form submissions |
| `/p/:id` | GET | Page rendering |
| `/agent` | POST | Agent data endpoint |

### Admin PWA API

The admin panel (`cmd/app`) has its own API endpoints served at `/admin/api/`:

| Route | Method | Description |
|-------|--------|-------------|
| `/login/dev` | POST | Dev mode login |
| `/login/slack/url` | GET | Slack OAuth URL |
| `/login/slack/exchange` | POST | Exchange OAuth code |
| `/me` | GET | Current user info |
| `/settings` | GET/PUT | System settings |
| `/dashboard/stats` | GET | Dashboard statistics |
| `/containers` | GET/POST | Container list/create |
| `/containers/:id` | GET/PUT/DELETE | Container CRUD |
| `/containers/batch-delete` | POST | Batch delete |

### Bot Webservice Routes

Each bot module can register its own webservice routes via `bot.Webservice()`. These are mounted dynamically at runtime.
